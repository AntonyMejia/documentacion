"use strict";(globalThis.webpackChunkdocumentacion=globalThis.webpackChunkdocumentacion||[]).push([[807],{5523:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec","title":"Incidencia 1 - Emisi\xf3n de tokens","description":"1. Resumen ejecutivo","source":"@site/docs/proyectos/docrew/documentacion/incidencias-cibersec/inc-cibersec-1.md","sourceDirName":"proyectos/docrew/documentacion/incidencias-cibersec","slug":"/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec","permalink":"/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"docrew-incidencia-cibersec","title":"Incidencia 1 - Emisi\xf3n de tokens"},"sidebar":"docsSidebar","previous":{"title":"Incidencias de ciberseguridad","permalink":"/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"},"next":{"title":"Resumen POPS","permalink":"/documentacion/proyectos/pops/"}}');var o=i(7259),r=i(5739);const c={id:"docrew-incidencia-cibersec",title:"Incidencia 1 - Emisi\xf3n de tokens"},l="Hallazgo 1 \u2013 Emisi\xf3n de tokens con alcance privilegiado (aws.cognito.signin.user.admin)",a={},d=[{value:"1. Resumen ejecutivo",id:"1-resumen-ejecutivo",level:2},{value:"2. Contexto t\xe9cnico de la aplicaci\xf3n",id:"2-contexto-t\xe9cnico-de-la-aplicaci\xf3n",level:2},{value:"2.1. Arquitectura de autenticaci\xf3n",id:"21-arquitectura-de-autenticaci\xf3n",level:3},{value:"2.2. Uso de tokens en la aplicaci\xf3n",id:"22-uso-de-tokens-en-la-aplicaci\xf3n",level:3},{value:"3. An\xe1lisis del alcance <code>aws.cognito.signin.user.admin</code>",id:"3-an\xe1lisis-del-alcance-awscognitosigninuseradmin",level:2},{value:"3.1. Definici\xf3n del scope",id:"31-definici\xf3n-del-scope",level:3},{value:"3.2. Permisos de atributos y alcance real",id:"32-permisos-de-atributos-y-alcance-real",level:3},{value:"3.3. Relaci\xf3n con la dependencia <code>aws-amplify</code>",id:"33-relaci\xf3n-con-la-dependencia-aws-amplify",level:3},{value:"4. Evaluaci\xf3n de impacto para el aplicativo",id:"4-evaluaci\xf3n-de-impacto-para-el-aplicativo",level:2},{value:"4.1. Riesgo te\xf3rico (descrito en el pentest)",id:"41-riesgo-te\xf3rico-descrito-en-el-pentest",level:3},{value:"4.2. Riesgo real (dependiente de configuraci\xf3n)",id:"42-riesgo-real-dependiente-de-configuraci\xf3n",level:3},{value:"5. Plan de tratamiento y medidas de mitigaci\xf3n",id:"5-plan-de-tratamiento-y-medidas-de-mitigaci\xf3n",level:2},{value:"5.1. Revisi\xf3n y restricci\xf3n de atributos de usuario",id:"51-revisi\xf3n-y-restricci\xf3n-de-atributos-de-usuario",level:3},{value:"5.2. Ajuste de tiempos de vida de tokens",id:"52-ajuste-de-tiempos-de-vida-de-tokens",level:3},{value:"5.3. Separaci\xf3n de capacidades administrativas",id:"53-separaci\xf3n-de-capacidades-administrativas",level:3},{value:"5.4. Monitoreo y auditor\xeda",id:"54-monitoreo-y-auditor\xeda",level:3},{value:"6. Conclusi\xf3n y clasificaci\xf3n final del hallazgo",id:"6-conclusi\xf3n-y-clasificaci\xf3n-final-del-hallazgo",level:2},{value:"7. Referencias",id:"7-referencias",level:2}];function t(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsxs)(n.h1,{id:"hallazgo-1--emisi\xf3n-de-tokens-con-alcance-privilegiado-awscognitosigninuseradmin",children:["Hallazgo 1 \u2013 Emisi\xf3n de tokens con alcance privilegiado (",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),")"]})}),"\n",(0,o.jsx)(n.h2,{id:"1-resumen-ejecutivo",children:"1. Resumen ejecutivo"}),"\n",(0,o.jsxs)(n.p,{children:["El pentest identific\xf3 que, tras autenticarse contra el ",(0,o.jsx)(n.strong,{children:"User Pool de AWS Cognito"}),", la aplicaci\xf3n recibe un ",(0,o.jsx)(n.strong,{children:"access token"})," con:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:'scope: "aws.cognito.signin.user.admin"'}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Tiempo de vida (",(0,o.jsx)(n.code,{children:"ExpiresIn"}),") aproximado de ",(0,o.jsx)(n.strong,{children:"24 horas"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Emisi\xf3n de ",(0,o.jsx)(n.strong,{children:"ID Token"})," y ",(0,o.jsx)(n.strong,{children:"Refresh Token"})," adicionales."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"El reporte lo clasifica como:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"CWE-266 \u2013 Incorrecta asignaci\xf3n de privilegios."})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"CVSSv3 9.9 \u2013 Alta criticidad."})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Tras el an\xe1lisis t\xe9cnico se concluye que:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["El scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})," es el ",(0,o.jsx)(n.strong,{children:"\xe1mbito reservado por defecto de Cognito"})," para tokens emitidos por la API de User Pools, y ",(0,o.jsx)(n.strong,{children:"autoriza \xfanicamente operaciones de autoservicio del propio usuario"})," (consulta/actualizaci\xf3n de sus atributos, MFA, dispositivos, etc.)."]}),"\n",(0,o.jsxs)(n.li,{children:["El nivel real de acceso ",(0,o.jsx)(n.strong,{children:"est\xe1 limitado por los permisos de lectura/escritura de atributos configurados en el App Client"})," del User Pool."]}),"\n",(0,o.jsxs)(n.li,{children:["El riesgo principal se origina en:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["La posibilidad de que ",(0,o.jsx)(n.strong,{children:"atributos sensibles (por ejemplo roles/permisos)"})," est\xe9n configurados como ",(0,o.jsx)(n.strong,{children:"editables"})," para el App Client."]}),"\n",(0,o.jsxs)(n.li,{children:["Un ",(0,o.jsx)(n.strong,{children:"TTL elevado del access token (24 h)"})," y la existencia de refresh tokens de larga duraci\xf3n."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["No se trata de un fallo en la dependencia ",(0,o.jsx)(n.code,{children:"aws-amplify"})," (versi\xf3n 4.3.30 o similar), sino de ",(0,o.jsx)(n.strong,{children:"configuraci\xf3n de Cognito"})," y de ",(0,o.jsx)(n.strong,{children:"pol\xedtica de tokens"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Este documento describe el an\xe1lisis, las medidas de mitigaci\xf3n y el plan de tratamiento."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-contexto-t\xe9cnico-de-la-aplicaci\xf3n",children:"2. Contexto t\xe9cnico de la aplicaci\xf3n"}),"\n",(0,o.jsx)(n.h3,{id:"21-arquitectura-de-autenticaci\xf3n",children:"2.1. Arquitectura de autenticaci\xf3n"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Proveedor de identidad:"})," AWS ",(0,o.jsx)(n.strong,{children:"Cognito User Pool"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cliente de aplicaci\xf3n:"})," Frontend Angular/Ionic."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"SDK utilizado en el front:"})," ",(0,o.jsx)(n.code,{children:"aws-amplify"})," (",(0,o.jsx)(n.code,{children:"Amplify.configure({ Auth: environment.cognito })"})," y ",(0,o.jsx)(n.code,{children:"Auth.signIn(username, password)"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Flujo observado:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"El usuario env\xeda credenciales al front."}),"\n",(0,o.jsxs)(n.li,{children:["El front llama a la API de Cognito (operaciones ",(0,o.jsx)(n.code,{children:"InitiateAuth"})," / ",(0,o.jsx)(n.code,{children:"RespondToAuthChallenge"})," encapsuladas por Amplify)."]}),"\n",(0,o.jsxs)(n.li,{children:["Cognito devuelve:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"AccessToken"})," (con scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"IdToken"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"RefreshToken"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["El access token se almacena en una cookie (p. ej. ",(0,o.jsx)(n.code,{children:"token"}),") para su uso posterior."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"22-uso-de-tokens-en-la-aplicaci\xf3n",children:"2.2. Uso de tokens en la aplicaci\xf3n"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["El ",(0,o.jsx)(n.strong,{children:"access token"})," se utiliza para consumir APIs protegidas."]}),"\n",(0,o.jsxs)(n.li,{children:["El ",(0,o.jsx)(n.strong,{children:"Id Token"})," se utiliza para identificar al usuario en el front."]}),"\n",(0,o.jsxs)(n.li,{children:["El ",(0,o.jsx)(n.strong,{children:"Refresh Token"})," permite obtener nuevos tokens sin pedir credenciales, mientras no expire."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.h2,{id:"3-an\xe1lisis-del-alcance-awscognitosigninuseradmin",children:["3. An\xe1lisis del alcance ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})]}),"\n",(0,o.jsx)(n.h3,{id:"31-definici\xf3n-del-scope",children:"3.1. Definici\xf3n del scope"}),"\n",(0,o.jsx)(n.p,{children:"Seg\xfan la documentaci\xf3n oficial de AWS:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["El ",(0,o.jsx)(n.strong,{children:"token de acceso"})," de un usuario con el scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})," es el permiso para:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Leer y escribir atributos del usuario."}),"\n",(0,o.jsx)(n.li,{children:"Enumerar factores de autenticaci\xf3n."}),"\n",(0,o.jsx)(n.li,{children:"Configurar preferencias de MFA."}),"\n",(0,o.jsx)(n.li,{children:"Gestionar dispositivos recordados."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Este scope ",(0,o.jsx)(n.strong,{children:"autoriza operaciones de autoservicio del usuario actual"})," en la API de Cognito (por ejemplo ",(0,o.jsx)(n.code,{children:"GetUser"})," y ",(0,o.jsx)(n.code,{children:"UpdateUserAttributes"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Cuando la autenticaci\xf3n se realiza directamente contra la ",(0,o.jsx)(n.strong,{children:"API de User Pools"}),", ",(0,o.jsx)(n.strong,{children:"\xe9ste es el \xfanico scope que se devuelve en el access token"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["En otras palabras: el scope ",(0,o.jsx)(n.strong,{children:"no otorga privilegios administrativos sobre otros usuarios ni sobre servicios de AWS"}),"; s\xf3lo aplica al ",(0,o.jsx)(n.strong,{children:"propio usuario autenticado"})," y est\xe1 limitado por los permisos de atributos."]}),"\n",(0,o.jsx)(n.h3,{id:"32-permisos-de-atributos-y-alcance-real",children:"3.2. Permisos de atributos y alcance real"}),"\n",(0,o.jsx)(n.p,{children:"AWS Cognito permite configurar, por cada App Client:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Para cada atributo (est\xe1ndar o ",(0,o.jsx)(n.code,{children:"custom:"}),"):","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Permiso de lectura"})," (incluible en tokens/consultas)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Permiso de escritura"})," (actualizable v\xeda API)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["El nivel de acceso del scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})," ",(0,o.jsx)(n.strong,{children:"depende de estos permisos"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Si un atributo est\xe1 marcado como:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Readable + Writable"}),", el usuario puede leerlo y modificarlo."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Readable only"}),", el usuario s\xf3lo puede consultarlo."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"No readable / no writable"}),", el atributo ni se devuelve ni se puede actualizar (se producir\xe1 ",(0,o.jsx)(n.code,{children:"NotAuthorizedException"})," en caso contrario)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Esto implica que ",(0,o.jsx)(n.strong,{children:"atributos cr\xedticos"})," (roles, flags de administrador, etc.) deben estar configurados como ",(0,o.jsx)(n.strong,{children:"no escribibles"})," para el App Client p\xfablico, o gestionados \xfanicamente desde backend."]}),"\n",(0,o.jsxs)(n.h3,{id:"33-relaci\xf3n-con-la-dependencia-aws-amplify",children:["3.3. Relaci\xf3n con la dependencia ",(0,o.jsx)(n.code,{children:"aws-amplify"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"aws-amplify"})," act\xfaa como ",(0,o.jsx)(n.strong,{children:"cliente"})," de la API de Cognito:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Env\xeda las credenciales."}),"\n",(0,o.jsx)(n.li,{children:"Recibe los tokens emitidos por el User Pool."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["El SDK ",(0,o.jsx)(n.strong,{children:"no define scopes ni tiempos de expiraci\xf3n"}),", s\xf3lo consume lo que Cognito entrega."]}),"\n",(0,o.jsxs)(n.li,{children:["Por tanto:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["El scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})," y la expiraci\xf3n de 24h ",(0,o.jsx)(n.strong,{children:"no dependen de la versi\xf3n de Amplify"}),", sino de la ",(0,o.jsx)(n.strong,{children:"configuraci\xf3n del User Pool"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-evaluaci\xf3n-de-impacto-para-el-aplicativo",children:"4. Evaluaci\xf3n de impacto para el aplicativo"}),"\n",(0,o.jsx)(n.h3,{id:"41-riesgo-te\xf3rico-descrito-en-el-pentest",children:"4.1. Riesgo te\xf3rico (descrito en el pentest)"}),"\n",(0,o.jsx)(n.p,{children:"El reporte considera que:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Con un token que tenga ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Un usuario podr\xeda llamar APIs como ",(0,o.jsx)(n.code,{children:"GetUser"})," / ",(0,o.jsx)(n.code,{children:"UpdateUserAttributes"})," y manipular informaci\xf3n de su cuenta."]}),"\n",(0,o.jsxs)(n.li,{children:["Si la aplicaci\xf3n usa atributos como ",(0,o.jsx)(n.code,{children:"custom:rol"})," para permisos, y estos son ",(0,o.jsx)(n.em,{children:"writable"}),", se podr\xeda producir ",(0,o.jsx)(n.strong,{children:"escalaci\xf3n de privilegios"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Con un ",(0,o.jsx)(n.strong,{children:"TTL de 24h"})," y refresh tokens sin revocaci\xf3n/rotaci\xf3n adecuada:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"El abuso podr\xeda extenderse en el tiempo si un token es comprometido."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"42-riesgo-real-dependiente-de-configuraci\xf3n",children:"4.2. Riesgo real (dependiente de configuraci\xf3n)"}),"\n",(0,o.jsx)(n.p,{children:"El impacto efectivo sobre el aplicativo depende de:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Uso de atributos de Cognito para autorizaci\xf3n:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Si los roles/permisos ",(0,o.jsx)(n.strong,{children:"no"})," est\xe1n en atributos editables por el cliente (p. ej. se gestionan en BD interna o grupos de Cognito devueltos s\xf3lo v\xeda backend el token no permite convertirse en administrador."]}),"\n",(0,o.jsxs)(n.li,{children:["Si existen atributos ",(0,o.jsx)(n.code,{children:"custom:"})," de rol/permisos marcados como ",(0,o.jsx)(n.em,{children:"writable"})," para el App Client, s\xed existe potencial de escalaci\xf3n."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"TTL y manejo de tokens:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Un ",(0,o.jsx)(n.strong,{children:"access token de 24h"})," ampl\xeda la ventana en caso de exfiltraci\xf3n."]}),"\n",(0,o.jsx)(n.li,{children:"El refresh token permite obtener nuevos tokens hasta su expiraci\xf3n (configurable de 1 hora a varios a\xf1os)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"En consecuencia, el hallazgo se clasifica internamente como:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Riesgo de configuraci\xf3n / hardening"}),", cuya severidad final depende de:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Resultado de la revisi\xf3n de atributos (si roles/permisos son editables o no)."}),"\n",(0,o.jsx)(n.li,{children:"Ajuste de tiempos de expiraci\xf3n de tokens."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"5-plan-de-tratamiento-y-medidas-de-mitigaci\xf3n",children:"5. Plan de tratamiento y medidas de mitigaci\xf3n"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Nota:"})," las acciones est\xe1n redactadas en tiempo futuro/presente. Pueden marcarse como ",(0,o.jsx)(n.em,{children:"Completadas"})," en el seguimiento interno una vez implementadas."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"51-revisi\xf3n-y-restricci\xf3n-de-atributos-de-usuario",children:"5.1. Revisi\xf3n y restricci\xf3n de atributos de usuario"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Objetivo:"})," Garantizar que ning\xfan usuario pueda modificar atributos que impacten permisos o modelo de seguridad a trav\xe9s del scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),"."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Acciones:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Inventario de atributos utilizados para autorizaci\xf3n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Identificar atributos est\xe1ndar y personalizados (",(0,o.jsx)(n.code,{children:"custom:role"}),", ",(0,o.jsx)(n.code,{children:"custom:isAdmin"}),", etc.) que influyan en:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Acceso a m\xf3dulos."}),"\n",(0,o.jsx)(n.li,{children:"Niveles de privilegio."}),"\n",(0,o.jsx)(n.li,{children:"Flags de administraci\xf3n."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Reconfiguraci\xf3n de permisos de atributos en el App Client"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["En Cognito Console:","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Ir a ",(0,o.jsx)(n.strong,{children:"User Pools"})," \u2192 seleccionar el User Pool de la aplicaci\xf3n."]}),"\n",(0,o.jsxs)(n.li,{children:["Men\xfa ",(0,o.jsx)(n.strong,{children:"App clients"})," \u2192 seleccionar el cliente utilizado por la app."]}),"\n",(0,o.jsxs)(n.li,{children:["Pesta\xf1a ",(0,o.jsx)(n.strong,{children:"Attribute permissions"})," \u2192 ",(0,o.jsx)(n.strong,{children:"Editar"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Asegurar que:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Los atributos de rol/permisos est\xe9n configurados como:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"S\xf3lo lectura (read)"})," para el App Client p\xfablico, o"]}),"\n",(0,o.jsx)(n.li,{children:"No expuestos al cliente (gesti\xf3n \xfanicamente servidor-a-servidor)."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["S\xf3lo los atributos estrictamente necesarios para el funcionamiento del front est\xe9n marcados como ",(0,o.jsx)(n.em,{children:"read/write"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Validaci\xf3n t\xe9cnica"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Desde un cliente de prueba (por ejemplo Postman/Burp) utilizar un access token para llamar a ",(0,o.jsx)(n.code,{children:"UpdateUserAttributes"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Verificar que:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Intentos de escritura sobre atributos de rol/permisos devuelven ",(0,o.jsx)(n.code,{children:"NotAuthorizedException"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"S\xf3lo atributos de perfil permitidos son modificables."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"52-ajuste-de-tiempos-de-vida-de-tokens",children:"5.2. Ajuste de tiempos de vida de tokens"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Objetivo:"})," Reducir la ventana de exposici\xf3n en caso de compromiso del token."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Acciones:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Access Token"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Modificar la configuraci\xf3n del App Client para que el ",(0,o.jsx)(n.strong,{children:"access token expire en un intervalo corto"}),", por ejemplo ",(0,o.jsx)(n.strong,{children:"10\u201315 minutos"}),", de acuerdo con las pol\xedticas internas y las recomendaciones de uso de Cognito."]}),"\n",(0,o.jsxs)(n.li,{children:["Ajustar el front para que:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"No almacene tokens m\xe1s tiempo que su vigencia real (cookies o storage deben caducar igual o antes)."}),"\n",(0,o.jsx)(n.li,{children:"Preferentemente, utilizar almacenamiento en memoria en lugar de cookies persistentes cuando sea viable."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Refresh Token"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Establecer un periodo de expiraci\xf3n acordado (por ejemplo, ",(0,o.jsx)(n.strong,{children:"1\u20137 d\xedas"})," seg\xfan criticidad y UX)."]}),"\n",(0,o.jsx)(n.li,{children:"Documentar el procedimiento de revocaci\xf3n/rotaci\xf3n de refresh tokens en incidentes de seguridad o revocaci\xf3n de acceso."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"53-separaci\xf3n-de-capacidades-administrativas",children:"5.3. Separaci\xf3n de capacidades administrativas"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Objetivo:"})," Asegurar que ninguna operaci\xf3n administrativa de Cognito se encuentre accesible con tokens de usuario final."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Acciones:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Revisar el c\xf3digo backend para confirmar que las operaciones:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"AdminListUsers"}),", ",(0,o.jsx)(n.code,{children:"AdminCreateUser"}),", ",(0,o.jsx)(n.code,{children:"AdminDeleteUser"}),", etc."]}),"\n",(0,o.jsxs)(n.li,{children:["Se ejecutan ",(0,o.jsx)(n.strong,{children:"\xfanicamente"})," desde servicios backend autenticados con credenciales IAM (roles de ejecuci\xf3n de Lambda, usuarios de sistema, etc.), ",(0,o.jsx)(n.strong,{children:"no desde el front"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Verificar que ",(0,o.jsx)(n.strong,{children:"no existen endpoints expuestos al front"})," que act\xfaen como \u201cproxy transparente\u201d de estas operaciones sin validaci\xf3n adicional de permisos."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Documentar en la arquitectura que:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Los tokens de usuario final (con ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),") s\xf3lo se utilizan para ",(0,o.jsx)(n.strong,{children:"operaciones de autoservicio"})," y para autenticaci\xf3n/autorizaci\xf3n de la app."]}),"\n",(0,o.jsx)(n.li,{children:"Las operaciones administrativas se realizan exclusivamente desde el backend."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"54-monitoreo-y-auditor\xeda",children:"5.4. Monitoreo y auditor\xeda"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Objetivo:"})," Detectar y responder de forma temprana a un uso an\xf3malo de los tokens / API de Cognito."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Acciones:"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Registro y an\xe1lisis de logs"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Habilitar o revisar:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"CloudTrail"})," y ",(0,o.jsx)(n.strong,{children:"CloudWatch Logs"})," para eventos de Cognito (especialmente ",(0,o.jsx)(n.code,{children:"UpdateUserAttributes"}),", ",(0,o.jsx)(n.code,{children:"GetUser"}),", ",(0,o.jsx)(n.code,{children:"Admin*"}),")."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Configurar alertas (por ejemplo, en CloudWatch / SIEM) para:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Vol\xfamenes inusuales de llamadas ",(0,o.jsx)(n.code,{children:"UpdateUserAttributes"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Intentos repetidos de actualizaci\xf3n de atributos de rol/permisos."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Revisi\xf3n peri\xf3dica"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Establecer revisiones peri\xf3dicas (trimestrales/semestrales) de:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Configuraci\xf3n de App Clients."}),"\n",(0,o.jsx)(n.li,{children:"Permisos de atributos."}),"\n",(0,o.jsx)(n.li,{children:"Tiempos de expiraci\xf3n de tokens."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"6-conclusi\xf3n-y-clasificaci\xf3n-final-del-hallazgo",children:"6. Conclusi\xf3n y clasificaci\xf3n final del hallazgo"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["El scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"})," ",(0,o.jsx)(n.strong,{children:"no es un comportamiento an\xf3malo del aplicativo ni de la librer\xeda Amplify"}),", sino el ",(0,o.jsx)(n.strong,{children:"scope est\xe1ndar emitido por AWS Cognito"})," para la API de User Pools."]}),"\n",(0,o.jsxs)(n.li,{children:["El potencial de \u201cincorrecta asignaci\xf3n de privilegios\u201d depende de:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Que existan ",(0,o.jsx)(n.strong,{children:"atributos de rol/permisos"})," configurados como ",(0,o.jsx)(n.strong,{children:"writable"})," para el App Client."]}),"\n",(0,o.jsx)(n.li,{children:"Que la aplicaci\xf3n utilice dichos atributos para autorizaci\xf3n sin controles adicionales."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["La configuraci\xf3n de ",(0,o.jsx)(n.strong,{children:"TTL de 24 horas para el access token"})," y refresh tokens prolongados incrementa la ventana de exposici\xf3n en caso de exfiltraci\xf3n, por lo que se considera una oportunidad clara de ",(0,o.jsx)(n.strong,{children:"hardening"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Con la aplicaci\xf3n de las medidas descritas:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Se limita la capacidad de modificaci\xf3n de atributos sensibles"})," \xfanicamente a canales administrativos controlados."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Se reduce de forma significativa la ventana de abuso"}),", ajustando tiempos de vida de Access/Refresh Tokens."]}),"\n",(0,o.jsxs)(n.li,{children:["Se refuerza la separaci\xf3n entre ",(0,o.jsx)(n.strong,{children:"operaciones de usuario final"})," y ",(0,o.jsx)(n.strong,{children:"operaciones administrativas"}),", alineando la soluci\xf3n con el principio de ",(0,o.jsx)(n.strong,{children:"m\xednimo privilegio"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Por lo anterior, el hallazgo puede reclasificarse internamente como:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"\u201cRiesgo de configuraci\xf3n / mejora de seguridad\u201d"}),", con ",(0,o.jsx)(n.strong,{children:"riesgo residual bajo"})," tras la implementaci\xf3n y verificaci\xf3n de los controles."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"7-referencias",children:"7. Referencias"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Descripci\xf3n del token de acceso \u2013 Amazon Cognito"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html",children:"https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["\xc1mbitos, M2M y APIs con servidores de recursos (scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),")"]}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/cognito-user-pools-define-resource-servers.html",children:"https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/cognito-user-pools-define-resource-servers.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Uso de atributos de usuario y permisos de lectura/escritura (User Pool Attributes)"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html",children:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Application-specific settings with app clients (permisos de atributos por app client)"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html",children:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Gesti\xf3n de expiraci\xf3n de tokens de User Pools"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-caching-tokens.html",children:"https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-caching-tokens.html"}),(0,o.jsx)(n.br,{}),"\n","y resumen de rangos de expiraci\xf3n:",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://aws.amazon.com/about-aws/whats-new/2020/08/amazon-cognito-user-pools-supports-customization-of-token-expiration/",children:"https://aws.amazon.com/about-aws/whats-new/2020/08/amazon-cognito-user-pools-supports-customization-of-token-expiration/"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["UpdateUserAttributes \u2013 API de Amazon Cognito (requiere scope ",(0,o.jsx)(n.code,{children:"aws.cognito.signin.user.admin"}),")"]}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UpdateUserAttributes.html",children:"https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UpdateUserAttributes.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Buenas pr\xe1cticas de seguridad para Amazon Cognito user pools"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-security-best-practices.html",children:"https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-security-best-practices.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Refresh tokens \u2013 Amazon Cognito"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html",children:"https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Art\xedculo externo: AWS Cognito Token Security \u2013 One step closer (Truesec)"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://www.truesec.com/hub/blog/aws-cognito-token-security-one-step-closer",children:"https://www.truesec.com/hub/blog/aws-cognito-token-security-one-step-closer"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Art\xedculo externo: AWS Cognito Privilege Escalation Using Custom Attributes Editing in User Pool"}),(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.a,{href:"https://medium.com/%40un1quely/aws-cognito-privilege-escalation-using-custom-attributes-editing-in-user-pool-2f8d6eaa3c7f",children:"https://medium.com/%40un1quely/aws-cognito-privilege-escalation-using-custom-attributes-editing-in-user-pool-2f8d6eaa3c7f"})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},5739:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>l});var s=i(6363);const o={},r=s.createContext(o);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);
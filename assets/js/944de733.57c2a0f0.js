"use strict";(globalThis.webpackChunkdocumentacion=globalThis.webpackChunkdocumentacion||[]).push([[434],{5739:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var a=i(6363);const s={},c=a.createContext(s);function r(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(c.Provider,{value:n},e.children)}},7459:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"proyectos/docrew/documentacion/cr/docrew-incidencia-5-cr-historia-2","title":"Incidencia 5 - Comentario PDF Back","description":"Almacenamiento y render de comentarios de revisi\xf3n en la evaluaci\xf3n","source":"@site/docs/proyectos/docrew/documentacion/cr/cr-proximos-incidencia-5-historia-2.md","sourceDirName":"proyectos/docrew/documentacion/cr","slug":"/proyectos/docrew/documentacion/cr/docrew-incidencia-5-cr-historia-2","permalink":"/documentacion/proyectos/docrew/documentacion/cr/docrew-incidencia-5-cr-historia-2","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"docrew-incidencia-5-cr-historia-2","title":"Incidencia 5 - Comentario PDF Back"},"sidebar":"docsSidebar","previous":{"title":"Incidencia 5 - Comentario PDF Front","permalink":"/documentacion/proyectos/docrew/documentacion/cr/docrew-incidencia-5-cr-historia-1"},"next":{"title":"Incidencias de ciberseguridad","permalink":"/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"}}');var s=i(7259),c=i(5739);const r={id:"docrew-incidencia-5-cr-historia-2",title:"Incidencia 5 - Comentario PDF Back"},l="Historia de Usuario \u2013 Backend / PDF",d={},o=[{value:"Almacenamiento y render de comentarios de revisi\xf3n en la evaluaci\xf3n",id:"almacenamiento-y-render-de-comentarios-de-revisi\xf3n-en-la-evaluaci\xf3n",level:2},{value:"Historia",id:"historia",level:2},{value:"Contexto de servicios",id:"contexto-de-servicios",level:2},{value:"Alcance funcional (Backend)",id:"alcance-funcional-backend",level:2},{value:"Incluye",id:"incluye",level:3},{value:"No Incluye",id:"no-incluye",level:3},{value:"Alcance t\xe9cnico (Backend)",id:"alcance-t\xe9cnico-backend",level:2},{value:"APIs / Servicios",id:"apis--servicios",level:3},{value:"Base de datos",id:"base-de-datos",level:3},{value:"Lambda / Generaci\xf3n de PDF",id:"lambda--generaci\xf3n-de-pdf",level:3},{value:"Logging / Observabilidad",id:"logging--observabilidad",level:3},{value:"Seguridad y datos",id:"seguridad-y-datos",level:3},{value:"Criterios de aceptaci\xf3n (Funcionales \u2013 Backend)",id:"criterios-de-aceptaci\xf3n-funcionales--backend",level:2},{value:"Criterios de aceptaci\xf3n (T\xe9cnicos \u2013 Backend)",id:"criterios-de-aceptaci\xf3n-t\xe9cnicos--backend",level:2},{value:"Tareas t\xe9cnicas (Checklist \u2013 Backend)",id:"tareas-t\xe9cnicas-checklist--backend",level:2},{value:"API / BD",id:"api--bd",level:3},{value:"Lambda / PDF",id:"lambda--pdf",level:3},{value:"QA / Pruebas Backend",id:"qa--pruebas-backend",level:3},{value:"Dependencias",id:"dependencias",level:2},{value:"Recursos relacionados",id:"recursos-relacionados",level:2}];function t(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"historia-de-usuario--backend--pdf",children:"Historia de Usuario \u2013 Backend / PDF"})}),"\n",(0,s.jsx)(n.h2,{id:"almacenamiento-y-render-de-comentarios-de-revisi\xf3n-en-la-evaluaci\xf3n",children:"Almacenamiento y render de comentarios de revisi\xf3n en la evaluaci\xf3n"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"historia",children:"Historia"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Como"})," ????",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Quiero"})," que los comentarios de revisi\xf3n capturados al firmar un record se almacenen y se incluyan autom\xe1ticamente en el PDF final de la evaluaci\xf3n",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Para"})," contar con un respaldo formal de las aclaraciones o correcciones realizadas sobre la evaluaci\xf3n en caso de auditor\xedas"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"contexto-de-servicios",children:"Contexto de servicios"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\xc1mbito:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"API de firma de records en Web"}),"\n",(0,s.jsx)(n.li,{children:"Base de datos de evaluaciones"}),"\n",(0,s.jsx)(n.li,{children:"Lambda / servicio encargado de generar los PDFs de formatos 7.7 y 7.1"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n:"}),(0,s.jsx)(n.br,{}),"\n","Cuando el revisor firma un record en la aplicaci\xf3n web, puede enviar un comentario opcional junto con sus datos de usuario.",(0,s.jsx)(n.br,{}),"\n","El backend debe:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Recibir y validar esta informaci\xf3n."}),"\n",(0,s.jsx)(n.li,{children:"Guardarla de forma persistente en la BD."}),"\n",(0,s.jsx)(n.li,{children:"Exponerla para que la lambda de generaci\xf3n de PDF la recupere."}),"\n",(0,s.jsxs)(n.li,{children:["Incluir una nueva p\xe1gina en el PDF con el comentario (si existe).",(0,s.jsx)(n.br,{}),"\n","Si no hay comentario, el PDF se mantiene igual al actual."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"alcance-funcional-backend",children:"Alcance funcional (Backend)"}),"\n",(0,s.jsx)(n.h3,{id:"incluye",children:"Incluye"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Nuevo endpoint de creaci\xf3n de comentario para recibir:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"comment"})," (texto libre opcional)"]}),"\n",(0,s.jsxs)(n.li,{children:["Datos del usuario firmante: ",(0,s.jsx)(n.code,{children:"signedById"}),", ",(0,s.jsx)(n.code,{children:"signedByName"})," (o equivalentes)"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persistencia:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Guardar comentario y metadatos asociados:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"usuario, fecha/hora, recordId"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Modelo flexible para permitir comentarios futuros (columnas en ",(0,s.jsx)(n.code,{children:"records"}),")"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Exposici\xf3n de datos:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Asegurar que la lambda pueda consultar el comentario mediante endpoint, evento o payload ya existente"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Generaci\xf3n de PDF:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Actualizar lambda para:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Verificar si el record tiene comentario"}),"\n",(0,s.jsxs)(n.li,{children:["Agregar una ",(0,s.jsx)(n.strong,{children:"nueva p\xe1gina"})," despu\xe9s de las firmas con:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"T\xedtulo \u201cComentario del revisor\u201d"}),"\n",(0,s.jsx)(n.li,{children:"Texto del comentario"}),"\n",(0,s.jsx)(n.li,{children:"Opcional: revisor + fecha/hora"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Si no hay comentario \u2192 no cambiar dise\xf1o actual"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Seguridad y cumplimiento:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sanitizaci\xf3n de entrada y salida"}),"\n",(0,s.jsx)(n.li,{children:"Evitar inyecci\xf3n de contenido en el PDF"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"no-incluye",children:"No Incluye"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cambios en la l\xf3gica de negocio de evaluaci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"Historial complejo de versiones de comentarios"}),"\n",(0,s.jsx)(n.li,{children:"Mostrar comentarios en otras interfaces (solo PDF)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"alcance-t\xe9cnico-backend",children:"Alcance t\xe9cnico (Backend)"}),"\n",(0,s.jsx)(n.h3,{id:"apis--servicios",children:"APIs / Servicios"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Crear endpoint de guardado de comentarios para:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Aceptar ",(0,s.jsx)(n.code,{children:"comment"})," y datos de usuario"]}),"\n",(0,s.jsx)(n.li,{children:"Validar longitud/tipo"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"base-de-datos",children:"Base de datos"}),"\n",(0,s.jsx)(n.p,{children:"Opciones de dise\xf1o:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Opci\xf3n A \u2013 Nuevas columnas en ",(0,s.jsx)(n.code,{children:"records"}),":"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"lastCommentText, lastCommentUserId, etc."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Opci\xf3n B \u2013 Nueva tabla ",(0,s.jsx)(n.code,{children:"record_comments"}),":"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"id, recordId, commentText, userId, userName, createdAt"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Crear migraciones y versionamiento del esquema."}),"\n",(0,s.jsx)(n.h3,{id:"lambda--generaci\xf3n-de-pdf",children:"Lambda / Generaci\xf3n de PDF"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Actualizar l\xf3gica de PDFs 7.7 y 7.1 para:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Consultar comentario por recordId"}),"\n",(0,s.jsxs)(n.li,{children:["Renderizar p\xe1gina adicional:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"T\xedtulo"}),"\n",(0,s.jsx)(n.li,{children:"Texto multil\xednea UTF-8"}),"\n",(0,s.jsx)(n.li,{children:"Usuario y fecha (opcional)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Respetar plantillas actuales sin romperlas"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"logging--observabilidad",children:"Logging / Observabilidad"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Registrar:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Comentarios recibidos"}),"\n",(0,s.jsx)(n.li,{children:"Fallos de persistencia"}),"\n",(0,s.jsx)(n.li,{children:"Errores al generar PDF"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"seguridad-y-datos",children:"Seguridad y datos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Sanitizar ",(0,s.jsx)(n.code,{children:"commentText"})]}),"\n",(0,s.jsx)(n.li,{children:"Verificar permisos del usuario que firma"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"criterios-de-aceptaci\xf3n-funcionales--backend",children:"Criterios de aceptaci\xf3n (Funcionales \u2013 Backend)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"El endpoint de guardar comentarios solo acepta peticiones con comentario y datos del usuario."}),"\n",(0,s.jsx)(n.li,{children:"Si hay comentario, se almacena correctamente en la BD asociado al recordId."}),"\n",(0,s.jsx)(n.li,{children:"El PDF generado con comentario incluye una p\xe1gina despu\xe9s de las firmas con texto del comentario."}),"\n",(0,s.jsx)(n.li,{children:"El PDF generado sin comentario permanece igual al actual."}),"\n",(0,s.jsx)(n.li,{children:"El comentario almacenado puede consultarse para regenerar PDFs sin errores."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"criterios-de-aceptaci\xf3n-t\xe9cnicos--backend",children:"Criterios de aceptaci\xf3n (T\xe9cnicos \u2013 Backend)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Las migraciones de BD se aplican correctamente en prueba y producci\xf3n."}),"\n",(0,s.jsx)(n.li,{children:"El endpoint mantiene compatibilidad hacia atr\xe1s: clientes sin comentario siguen funcionando."}),"\n",(0,s.jsxs)(n.li,{children:["La lambda maneja correctamente casos de:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Comentario vac\xedo"}),"\n",(0,s.jsx)(n.li,{children:"Comentario largo"}),"\n",(0,s.jsx)(n.li,{children:"Caracteres especiales UTF-8"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"No se generan errores no controlados durante firma o generaci\xf3n de PDF."}),"\n",(0,s.jsxs)(n.li,{children:["Las pruebas autom\xe1ticas cubren:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Firma con comentario"}),"\n",(0,s.jsx)(n.li,{children:"Firma sin comentario"}),"\n",(0,s.jsx)(n.li,{children:"PDF con comentario"}),"\n",(0,s.jsx)(n.li,{children:"PDF sin comentario"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"tareas-t\xe9cnicas-checklist--backend",children:"Tareas t\xe9cnicas (Checklist \u2013 Backend)"}),"\n",(0,s.jsx)(n.h3,{id:"api--bd",children:"API / BD"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Dise\xf1ar modelo para almacenar comentarios"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Crear migraci\xf3n (tabla nueva o columnas nuevas)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Actualizar endpoint de firma para aceptar ",(0,s.jsx)(n.code,{children:"comment"})," y datos de usuario"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implementar persistencia del comentario"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Actualizar documentaci\xf3n del API"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"lambda--pdf",children:"Lambda / PDF"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Actualizar lambda para consultar comentario por recordId"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Agregar p\xe1gina adicional al PDF cuando exista comentario"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implementar formato y soporte de texto multil\xednea UTF-8"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Realizar pruebas de performance por generaci\xf3n masiva"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"qa--pruebas-backend",children:"QA / Pruebas Backend"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pruebas unitarias del endpoint (con y sin comentario)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pruebas de persistencia y lectura en BD"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pruebas de PDF: sin comentario, con comentario corto y con comentario largo"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pruebas de regresi\xf3n para verificar que otros PDFs no se rompan"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"dependencias",children:"Dependencias"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Coordinaci\xf3n con Frontend para definir nombres de campos y validar payloads."}),"\n",(0,s.jsx)(n.li,{children:"DevOps para desplegar migraciones y actualizar lambdas."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"recursos-relacionados",children:"Recursos relacionados"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Esquema actual de BD de evaluaciones/records"}),"\n",(0,s.jsx)(n.li,{children:"C\xf3digo y plantillas de lambda de PDF (7.7 y 7.1)"}),"\n",(0,s.jsx)(n.li,{children:"Documentaci\xf3n del flujo de firma de evaluaciones"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}}}]);
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Incidencia 1 - Emisión de tokens | Documentación</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://antonymejia.github.io/documentacion/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://antonymejia.github.io/documentacion/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Incidencia 1 - Emisión de tokens | Documentación"><meta data-rh="true" name="description" content="1. Resumen ejecutivo"><meta data-rh="true" property="og:description" content="1. Resumen ejecutivo"><link data-rh="true" rel="icon" href="/documentacion/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec"><link data-rh="true" rel="alternate" href="https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec" hreflang="en"><link data-rh="true" rel="alternate" href="https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docrew","item":"https://antonymejia.github.io/documentacion/proyectos/docrew/"},{"@type":"ListItem","position":2,"name":"Incidencias de ciberseguridad","item":"https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"},{"@type":"ListItem","position":3,"name":"Incidencia 1 - Emisión de tokens","item":"https://antonymejia.github.io/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec"}]}</script><link rel="stylesheet" href="/documentacion/assets/css/styles.c3b76e4c.css">
<script src="/documentacion/assets/js/runtime~main.43c4ee6f.js" defer="defer"></script>
<script src="/documentacion/assets/js/main.ce95babf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentacion/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_p9_q" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentacion/"><div class="navbar__logo"><img src="/documentacion/img/logo.svg" alt="Notas de proyectos" class="themedComponent_YKhZ themedComponent--light_ozdG"><img src="/documentacion/img/logo.svg" alt="Notas de proyectos" class="themedComponent_YKhZ themedComponent--dark_LWRx"></div><b class="navbar__title text--truncate">Notas de proyectos</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documentacion/">Documentación</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_RpzG colorModeToggle_DTKx"><button class="clean-btn toggleButton_WPek toggleButtonDisabled_tlsA" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_qSMH lightToggleIcon_kdKw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_qSMH darkToggleIcon_mRc9"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_qSMH systemToggleIcon_OJmt"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_v_oI"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_QuHS"><div class="docsWrapper_SE4m"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iFnj" type="button"></button><div class="docRoot_xR5m"><aside class="theme-doc-sidebar-container docSidebarContainer_CGKU"><div class="sidebarViewport_hAkj"><div class="sidebar_AIqc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_sCoW"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentacion/"><span title="Notas de proyectos" class="linkLabel_YxY9">Notas de proyectos</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentacion/proyectos/docrew/"><span title="Proyectos" class="categoryLinkLabel_s83I">Proyectos</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--active" tabindex="0" href="/documentacion/proyectos/docrew/"><span title="Docrew" class="categoryLinkLabel_s83I">Docrew</span></a><button aria-label="Collapse sidebar category &#x27;Docrew&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/documentacion/proyectos/docrew/documentacion/cr/docrew-incidencia-1-cr-historia-1"><span title="Documentación" class="categoryLinkLabel_s83I">Documentación</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentacion/proyectos/docrew/documentacion/cr/docrew-incidencia-1-cr-historia-1"><span title="CR - 02/11/2025" class="categoryLinkLabel_s83I">CR - 02/11/2025</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--active" tabindex="0" href="/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"><span title="Incidencias de ciberseguridad" class="categoryLinkLabel_s83I">Incidencias de ciberseguridad</span></a><button aria-label="Collapse sidebar category &#x27;Incidencias de ciberseguridad&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/docrew-incidencia-cibersec"><span title="Incidencia 1 - Emisión de tokens" class="linkLabel_YxY9">Incidencia 1 - Emisión de tokens</span></a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist" tabindex="0" href="/documentacion/proyectos/pops/"><span title="POPS" class="categoryLinkLabel_s83I">POPS</span></a><button aria-label="Expand sidebar category &#x27;POPS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_TRFn menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentacion/plantillas/plantilla-historia-frontend"><span title="Plantillas" class="categoryLinkLabel_s83I">Plantillas</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SKSh"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zzI5"><div class="docItemContainer_pn2X"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Vjls" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentacion/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_vufA"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Proyectos</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentacion/proyectos/docrew/"><span>Docrew</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Documentación</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"><span>Incidencias de ciberseguridad</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Incidencia 1 - Emisión de tokens</span></li></ul></nav><div class="tocCollapsible_s6b7 theme-doc-toc-mobile tocMobile_hAtY"><button type="button" class="clean-btn tocCollapsibleButton_SrO4">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Hallazgo 1 – Emisión de tokens con alcance privilegiado (<code>aws.cognito.signin.user.admin</code>)</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="1-resumen-ejecutivo">1. Resumen ejecutivo<a href="#1-resumen-ejecutivo" class="hash-link" aria-label="Direct link to 1. Resumen ejecutivo" title="Direct link to 1. Resumen ejecutivo" translate="no">​</a></h2>
<p>El pentest identificó que, tras autenticarse contra el <strong>User Pool de AWS Cognito</strong>, la aplicación recibe un <strong>access token</strong> con:</p>
<ul>
<li class=""><code>scope: &quot;aws.cognito.signin.user.admin&quot;</code>.</li>
<li class="">Tiempo de vida (<code>ExpiresIn</code>) aproximado de <strong>24 horas</strong>.</li>
<li class="">Emisión de <strong>ID Token</strong> y <strong>Refresh Token</strong> adicionales.</li>
</ul>
<p>El reporte lo clasifica como:</p>
<ul>
<li class=""><strong>CWE-266 – Incorrecta asignación de privilegios.</strong></li>
<li class=""><strong>CVSSv3 9.9 – Alta criticidad.</strong></li>
</ul>
<p>Tras el análisis técnico se concluye que:</p>
<ol>
<li class="">El scope <code>aws.cognito.signin.user.admin</code> es el <strong>ámbito reservado por defecto de Cognito</strong> para tokens emitidos por la API de User Pools, y <strong>autoriza únicamente operaciones de autoservicio del propio usuario</strong> (consulta/actualización de sus atributos, MFA, dispositivos, etc.).</li>
<li class="">El nivel real de acceso <strong>está limitado por los permisos de lectura/escritura de atributos configurados en el App Client</strong> del User Pool.</li>
<li class="">El riesgo principal se origina en:<!-- -->
<ul>
<li class="">La posibilidad de que <strong>atributos sensibles (por ejemplo roles/permisos)</strong> estén configurados como <strong>editables</strong> para el App Client.</li>
<li class="">Un <strong>TTL elevado del access token (24 h)</strong> y la existencia de refresh tokens de larga duración.</li>
</ul>
</li>
</ol>
<p>No se trata de un fallo en la dependencia <code>aws-amplify</code> (versión 4.3.30 o similar), sino de <strong>configuración de Cognito</strong> y de <strong>política de tokens</strong>.</p>
<p>Este documento describe el análisis, las medidas de mitigación y el plan de tratamiento.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="2-contexto-técnico-de-la-aplicación">2. Contexto técnico de la aplicación<a href="#2-contexto-técnico-de-la-aplicación" class="hash-link" aria-label="Direct link to 2. Contexto técnico de la aplicación" title="Direct link to 2. Contexto técnico de la aplicación" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="21-arquitectura-de-autenticación">2.1. Arquitectura de autenticación<a href="#21-arquitectura-de-autenticación" class="hash-link" aria-label="Direct link to 2.1. Arquitectura de autenticación" title="Direct link to 2.1. Arquitectura de autenticación" translate="no">​</a></h3>
<ul>
<li class=""><strong>Proveedor de identidad:</strong> AWS <strong>Cognito User Pool</strong>.</li>
<li class=""><strong>Cliente de aplicación:</strong> Frontend Angular/Ionic.</li>
<li class=""><strong>SDK utilizado en el front:</strong> <code>aws-amplify</code> (<code>Amplify.configure({ Auth: environment.cognito })</code> y <code>Auth.signIn(username, password)</code>).</li>
<li class=""><strong>Flujo observado:</strong>
<ol>
<li class="">El usuario envía credenciales al front.</li>
<li class="">El front llama a la API de Cognito (operaciones <code>InitiateAuth</code> / <code>RespondToAuthChallenge</code> encapsuladas por Amplify).</li>
<li class="">Cognito devuelve:<!-- -->
<ul>
<li class=""><code>AccessToken</code> (con scope <code>aws.cognito.signin.user.admin</code>).</li>
<li class=""><code>IdToken</code>.</li>
<li class=""><code>RefreshToken</code>.</li>
</ul>
</li>
<li class="">El access token se almacena en una cookie (p. ej. <code>token</code>) para su uso posterior.</li>
</ol>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="22-uso-de-tokens-en-la-aplicación">2.2. Uso de tokens en la aplicación<a href="#22-uso-de-tokens-en-la-aplicación" class="hash-link" aria-label="Direct link to 2.2. Uso de tokens en la aplicación" title="Direct link to 2.2. Uso de tokens en la aplicación" translate="no">​</a></h3>
<ul>
<li class="">El <strong>access token</strong> se utiliza para consumir APIs protegidas.</li>
<li class="">El <strong>Id Token</strong> se utiliza para identificar al usuario en el front.</li>
<li class="">El <strong>Refresh Token</strong> permite obtener nuevos tokens sin pedir credenciales, mientras no expire.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="3-análisis-del-alcance-awscognitosigninuseradmin">3. Análisis del alcance <code>aws.cognito.signin.user.admin</code><a href="#3-análisis-del-alcance-awscognitosigninuseradmin" class="hash-link" aria-label="Direct link to 3-análisis-del-alcance-awscognitosigninuseradmin" title="Direct link to 3-análisis-del-alcance-awscognitosigninuseradmin" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="31-definición-del-scope">3.1. Definición del scope<a href="#31-definición-del-scope" class="hash-link" aria-label="Direct link to 3.1. Definición del scope" title="Direct link to 3.1. Definición del scope" translate="no">​</a></h3>
<p>Según la documentación oficial de AWS:</p>
<ul>
<li class="">El <strong>token de acceso</strong> de un usuario con el scope <code>aws.cognito.signin.user.admin</code> es el permiso para:<!-- -->
<ul>
<li class="">Leer y escribir atributos del usuario.</li>
<li class="">Enumerar factores de autenticación.</li>
<li class="">Configurar preferencias de MFA.</li>
<li class="">Gestionar dispositivos recordados.</li>
</ul>
</li>
<li class="">Este scope <strong>autoriza operaciones de autoservicio del usuario actual</strong> en la API de Cognito (por ejemplo <code>GetUser</code> y <code>UpdateUserAttributes</code>).</li>
<li class="">Cuando la autenticación se realiza directamente contra la <strong>API de User Pools</strong>, <strong>éste es el único scope que se devuelve en el access token</strong>.</li>
</ul>
<p>En otras palabras: el scope <strong>no otorga privilegios administrativos sobre otros usuarios ni sobre servicios de AWS</strong>; sólo aplica al <strong>propio usuario autenticado</strong> y está limitado por los permisos de atributos.</p>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="32-permisos-de-atributos-y-alcance-real">3.2. Permisos de atributos y alcance real<a href="#32-permisos-de-atributos-y-alcance-real" class="hash-link" aria-label="Direct link to 3.2. Permisos de atributos y alcance real" title="Direct link to 3.2. Permisos de atributos y alcance real" translate="no">​</a></h3>
<p>AWS Cognito permite configurar, por cada App Client:</p>
<ul>
<li class="">Para cada atributo (estándar o <code>custom:</code>):<!-- -->
<ul>
<li class=""><strong>Permiso de lectura</strong> (incluible en tokens/consultas).</li>
<li class=""><strong>Permiso de escritura</strong> (actualizable vía API).</li>
</ul>
</li>
</ul>
<p>El nivel de acceso del scope <code>aws.cognito.signin.user.admin</code> <strong>depende de estos permisos</strong>:</p>
<ul>
<li class="">Si un atributo está marcado como:<!-- -->
<ul>
<li class=""><strong>Readable + Writable</strong>, el usuario puede leerlo y modificarlo.</li>
<li class=""><strong>Readable only</strong>, el usuario sólo puede consultarlo.</li>
<li class=""><strong>No readable / no writable</strong>, el atributo ni se devuelve ni se puede actualizar (se producirá <code>NotAuthorizedException</code> en caso contrario).</li>
</ul>
</li>
</ul>
<p>Esto implica que <strong>atributos críticos</strong> (roles, flags de administrador, etc.) deben estar configurados como <strong>no escribibles</strong> para el App Client público, o gestionados únicamente desde backend.</p>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="33-relación-con-la-dependencia-aws-amplify">3.3. Relación con la dependencia <code>aws-amplify</code><a href="#33-relación-con-la-dependencia-aws-amplify" class="hash-link" aria-label="Direct link to 33-relación-con-la-dependencia-aws-amplify" title="Direct link to 33-relación-con-la-dependencia-aws-amplify" translate="no">​</a></h3>
<ul>
<li class=""><code>aws-amplify</code> actúa como <strong>cliente</strong> de la API de Cognito:<!-- -->
<ul>
<li class="">Envía las credenciales.</li>
<li class="">Recibe los tokens emitidos por el User Pool.</li>
</ul>
</li>
<li class="">El SDK <strong>no define scopes ni tiempos de expiración</strong>, sólo consume lo que Cognito entrega.</li>
<li class="">Por tanto:<!-- -->
<ul>
<li class="">El scope <code>aws.cognito.signin.user.admin</code> y la expiración de 24h <strong>no dependen de la versión de Amplify</strong>, sino de la <strong>configuración del User Pool</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="4-evaluación-de-impacto-para-el-aplicativo">4. Evaluación de impacto para el aplicativo<a href="#4-evaluación-de-impacto-para-el-aplicativo" class="hash-link" aria-label="Direct link to 4. Evaluación de impacto para el aplicativo" title="Direct link to 4. Evaluación de impacto para el aplicativo" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="41-riesgo-teórico-descrito-en-el-pentest">4.1. Riesgo teórico (descrito en el pentest)<a href="#41-riesgo-teórico-descrito-en-el-pentest" class="hash-link" aria-label="Direct link to 4.1. Riesgo teórico (descrito en el pentest)" title="Direct link to 4.1. Riesgo teórico (descrito en el pentest)" translate="no">​</a></h3>
<p>El reporte considera que:</p>
<ul>
<li class="">Con un token que tenga <code>aws.cognito.signin.user.admin</code>:<!-- -->
<ul>
<li class="">Un usuario podría llamar APIs como <code>GetUser</code> / <code>UpdateUserAttributes</code> y manipular información de su cuenta.</li>
<li class="">Si la aplicación usa atributos como <code>custom:rol</code> para permisos, y estos son <em>writable</em>, se podría producir <strong>escalación de privilegios</strong>.</li>
</ul>
</li>
<li class="">Con un <strong>TTL de 24h</strong> y refresh tokens sin revocación/rotación adecuada:<!-- -->
<ul>
<li class="">El abuso podría extenderse en el tiempo si un token es comprometido.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="42-riesgo-real-dependiente-de-configuración">4.2. Riesgo real (dependiente de configuración)<a href="#42-riesgo-real-dependiente-de-configuración" class="hash-link" aria-label="Direct link to 4.2. Riesgo real (dependiente de configuración)" title="Direct link to 4.2. Riesgo real (dependiente de configuración)" translate="no">​</a></h3>
<p>El impacto efectivo sobre el aplicativo depende de:</p>
<ol>
<li class="">
<p><strong>Uso de atributos de Cognito para autorización:</strong></p>
<ul>
<li class="">Si los roles/permisos <strong>no</strong> están en atributos editables por el cliente (p. ej. se gestionan en BD interna o grupos de Cognito devueltos sólo vía backend el token no permite convertirse en administrador.</li>
<li class="">Si existen atributos <code>custom:</code> de rol/permisos marcados como <em>writable</em> para el App Client, sí existe potencial de escalación.</li>
</ul>
</li>
<li class="">
<p><strong>TTL y manejo de tokens:</strong></p>
<ul>
<li class="">Un <strong>access token de 24h</strong> amplía la ventana en caso de exfiltración.</li>
<li class="">El refresh token permite obtener nuevos tokens hasta su expiración (configurable de 1 hora a varios años).</li>
</ul>
</li>
</ol>
<p>En consecuencia, el hallazgo se clasifica internamente como:</p>
<ul>
<li class=""><strong>Riesgo de configuración / hardening</strong>, cuya severidad final depende de:<!-- -->
<ul>
<li class="">Resultado de la revisión de atributos (si roles/permisos son editables o no).</li>
<li class="">Ajuste de tiempos de expiración de tokens.</li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="5-plan-de-tratamiento-y-medidas-de-mitigación">5. Plan de tratamiento y medidas de mitigación<a href="#5-plan-de-tratamiento-y-medidas-de-mitigación" class="hash-link" aria-label="Direct link to 5. Plan de tratamiento y medidas de mitigación" title="Direct link to 5. Plan de tratamiento y medidas de mitigación" translate="no">​</a></h2>
<blockquote>
<p><strong>Nota:</strong> las acciones están redactadas en tiempo futuro/presente. Pueden marcarse como <em>Completadas</em> en el seguimiento interno una vez implementadas.</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="51-revisión-y-restricción-de-atributos-de-usuario">5.1. Revisión y restricción de atributos de usuario<a href="#51-revisión-y-restricción-de-atributos-de-usuario" class="hash-link" aria-label="Direct link to 5.1. Revisión y restricción de atributos de usuario" title="Direct link to 5.1. Revisión y restricción de atributos de usuario" translate="no">​</a></h3>
<p><strong>Objetivo:</strong> Garantizar que ningún usuario pueda modificar atributos que impacten permisos o modelo de seguridad a través del scope <code>aws.cognito.signin.user.admin</code>.</p>
<p><strong>Acciones:</strong></p>
<ol>
<li class="">
<p><strong>Inventario de atributos utilizados para autorización</strong></p>
<ul>
<li class="">Identificar atributos estándar y personalizados (<code>custom:role</code>, <code>custom:isAdmin</code>, etc.) que influyan en:<!-- -->
<ul>
<li class="">Acceso a módulos.</li>
<li class="">Niveles de privilegio.</li>
<li class="">Flags de administración.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Reconfiguración de permisos de atributos en el App Client</strong></p>
<ul>
<li class="">En Cognito Console:<!-- -->
<ol>
<li class="">Ir a <strong>User Pools</strong> → seleccionar el User Pool de la aplicación.</li>
<li class="">Menú <strong>App clients</strong> → seleccionar el cliente utilizado por la app.</li>
<li class="">Pestaña <strong>Attribute permissions</strong> → <strong>Editar</strong>.</li>
</ol>
</li>
<li class="">Asegurar que:<!-- -->
<ul>
<li class="">Los atributos de rol/permisos estén configurados como:<!-- -->
<ul>
<li class=""><strong>Sólo lectura (read)</strong> para el App Client público, o</li>
<li class="">No expuestos al cliente (gestión únicamente servidor-a-servidor).</li>
</ul>
</li>
<li class="">Sólo los atributos estrictamente necesarios para el funcionamiento del front estén marcados como <em>read/write</em>.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Validación técnica</strong></p>
<ul>
<li class="">Desde un cliente de prueba (por ejemplo Postman/Burp) utilizar un access token para llamar a <code>UpdateUserAttributes</code>.</li>
<li class="">Verificar que:<!-- -->
<ul>
<li class="">Intentos de escritura sobre atributos de rol/permisos devuelven <code>NotAuthorizedException</code>.</li>
<li class="">Sólo atributos de perfil permitidos son modificables.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="52-ajuste-de-tiempos-de-vida-de-tokens">5.2. Ajuste de tiempos de vida de tokens<a href="#52-ajuste-de-tiempos-de-vida-de-tokens" class="hash-link" aria-label="Direct link to 5.2. Ajuste de tiempos de vida de tokens" title="Direct link to 5.2. Ajuste de tiempos de vida de tokens" translate="no">​</a></h3>
<p><strong>Objetivo:</strong> Reducir la ventana de exposición en caso de compromiso del token.</p>
<p><strong>Acciones:</strong></p>
<ol>
<li class="">
<p><strong>Access Token</strong></p>
<ul>
<li class="">Modificar la configuración del App Client para que el <strong>access token expire en un intervalo corto</strong>, por ejemplo <strong>10–15 minutos</strong>, de acuerdo con las políticas internas y las recomendaciones de uso de Cognito.</li>
<li class="">Ajustar el front para que:<!-- -->
<ul>
<li class="">No almacene tokens más tiempo que su vigencia real (cookies o storage deben caducar igual o antes).</li>
<li class="">Preferentemente, utilizar almacenamiento en memoria en lugar de cookies persistentes cuando sea viable.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Refresh Token</strong></p>
<ul>
<li class="">Establecer un periodo de expiración acordado (por ejemplo, <strong>1–7 días</strong> según criticidad y UX).</li>
<li class="">Documentar el procedimiento de revocación/rotación de refresh tokens en incidentes de seguridad o revocación de acceso.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="53-separación-de-capacidades-administrativas">5.3. Separación de capacidades administrativas<a href="#53-separación-de-capacidades-administrativas" class="hash-link" aria-label="Direct link to 5.3. Separación de capacidades administrativas" title="Direct link to 5.3. Separación de capacidades administrativas" translate="no">​</a></h3>
<p><strong>Objetivo:</strong> Asegurar que ninguna operación administrativa de Cognito se encuentre accesible con tokens de usuario final.</p>
<p><strong>Acciones:</strong></p>
<ol>
<li class="">
<p>Revisar el código backend para confirmar que las operaciones:</p>
<ul>
<li class=""><code>AdminListUsers</code>, <code>AdminCreateUser</code>, <code>AdminDeleteUser</code>, etc.</li>
<li class="">Se ejecutan <strong>únicamente</strong> desde servicios backend autenticados con credenciales IAM (roles de ejecución de Lambda, usuarios de sistema, etc.), <strong>no desde el front</strong>.</li>
</ul>
</li>
<li class="">
<p>Verificar que <strong>no existen endpoints expuestos al front</strong> que actúen como “proxy transparente” de estas operaciones sin validación adicional de permisos.</p>
</li>
<li class="">
<p>Documentar en la arquitectura que:</p>
<ul>
<li class="">Los tokens de usuario final (con <code>aws.cognito.signin.user.admin</code>) sólo se utilizan para <strong>operaciones de autoservicio</strong> y para autenticación/autorización de la app.</li>
<li class="">Las operaciones administrativas se realizan exclusivamente desde el backend.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_UAfo" id="54-monitoreo-y-auditoría">5.4. Monitoreo y auditoría<a href="#54-monitoreo-y-auditoría" class="hash-link" aria-label="Direct link to 5.4. Monitoreo y auditoría" title="Direct link to 5.4. Monitoreo y auditoría" translate="no">​</a></h3>
<p><strong>Objetivo:</strong> Detectar y responder de forma temprana a un uso anómalo de los tokens / API de Cognito.</p>
<p><strong>Acciones:</strong></p>
<ol>
<li class="">
<p><strong>Registro y análisis de logs</strong></p>
<ul>
<li class="">Habilitar o revisar:<!-- -->
<ul>
<li class=""><strong>CloudTrail</strong> y <strong>CloudWatch Logs</strong> para eventos de Cognito (especialmente <code>UpdateUserAttributes</code>, <code>GetUser</code>, <code>Admin*</code>).</li>
</ul>
</li>
<li class="">Configurar alertas (por ejemplo, en CloudWatch / SIEM) para:<!-- -->
<ul>
<li class="">Volúmenes inusuales de llamadas <code>UpdateUserAttributes</code>.</li>
<li class="">Intentos repetidos de actualización de atributos de rol/permisos.</li>
</ul>
</li>
</ul>
</li>
<li class="">
<p><strong>Revisión periódica</strong></p>
<ul>
<li class="">Establecer revisiones periódicas (trimestrales/semestrales) de:<!-- -->
<ul>
<li class="">Configuración de App Clients.</li>
<li class="">Permisos de atributos.</li>
<li class="">Tiempos de expiración de tokens.</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="6-conclusión-y-clasificación-final-del-hallazgo">6. Conclusión y clasificación final del hallazgo<a href="#6-conclusión-y-clasificación-final-del-hallazgo" class="hash-link" aria-label="Direct link to 6. Conclusión y clasificación final del hallazgo" title="Direct link to 6. Conclusión y clasificación final del hallazgo" translate="no">​</a></h2>
<ol>
<li class="">El scope <code>aws.cognito.signin.user.admin</code> <strong>no es un comportamiento anómalo del aplicativo ni de la librería Amplify</strong>, sino el <strong>scope estándar emitido por AWS Cognito</strong> para la API de User Pools.</li>
<li class="">El potencial de “incorrecta asignación de privilegios” depende de:<!-- -->
<ul>
<li class="">Que existan <strong>atributos de rol/permisos</strong> configurados como <strong>writable</strong> para el App Client.</li>
<li class="">Que la aplicación utilice dichos atributos para autorización sin controles adicionales.</li>
</ul>
</li>
<li class="">La configuración de <strong>TTL de 24 horas para el access token</strong> y refresh tokens prolongados incrementa la ventana de exposición en caso de exfiltración, por lo que se considera una oportunidad clara de <strong>hardening</strong>.</li>
</ol>
<p>Con la aplicación de las medidas descritas:</p>
<ul>
<li class=""><strong>Se limita la capacidad de modificación de atributos sensibles</strong> únicamente a canales administrativos controlados.</li>
<li class=""><strong>Se reduce de forma significativa la ventana de abuso</strong>, ajustando tiempos de vida de Access/Refresh Tokens.</li>
<li class="">Se refuerza la separación entre <strong>operaciones de usuario final</strong> y <strong>operaciones administrativas</strong>, alineando la solución con el principio de <strong>mínimo privilegio</strong>.</li>
</ul>
<p>Por lo anterior, el hallazgo puede reclasificarse internamente como:</p>
<ul>
<li class=""><strong>“Riesgo de configuración / mejora de seguridad”</strong>, con <strong>riesgo residual bajo</strong> tras la implementación y verificación de los controles.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_UAfo" id="7-referencias">7. Referencias<a href="#7-referencias" class="hash-link" aria-label="Direct link to 7. Referencias" title="Direct link to 7. Referencias" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Descripción del token de acceso – Amazon Cognito</strong><br>
<a href="https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html</a></p>
</li>
<li class="">
<p><strong>Ámbitos, M2M y APIs con servidores de recursos (scope <code>aws.cognito.signin.user.admin</code>)</strong><br>
<a href="https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/cognito-user-pools-define-resource-servers.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/es_es/cognito/latest/developerguide/cognito-user-pools-define-resource-servers.html</a></p>
</li>
<li class="">
<p><strong>Uso de atributos de usuario y permisos de lectura/escritura (User Pool Attributes)</strong><br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html</a></p>
</li>
<li class="">
<p><strong>Application-specific settings with app clients (permisos de atributos por app client)</strong><br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html</a></p>
</li>
<li class="">
<p><strong>Gestión de expiración de tokens de User Pools</strong><br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-caching-tokens.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-caching-tokens.html</a><br>
<!-- -->y resumen de rangos de expiración:<br>
<a href="https://aws.amazon.com/about-aws/whats-new/2020/08/amazon-cognito-user-pools-supports-customization-of-token-expiration/" target="_blank" rel="noopener noreferrer" class="">https://aws.amazon.com/about-aws/whats-new/2020/08/amazon-cognito-user-pools-supports-customization-of-token-expiration/</a></p>
</li>
<li class="">
<p><strong>UpdateUserAttributes – API de Amazon Cognito (requiere scope <code>aws.cognito.signin.user.admin</code>)</strong><br>
<a href="https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UpdateUserAttributes.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_UpdateUserAttributes.html</a></p>
</li>
<li class="">
<p><strong>Buenas prácticas de seguridad para Amazon Cognito user pools</strong><br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-security-best-practices.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-security-best-practices.html</a></p>
</li>
<li class="">
<p><strong>Refresh tokens – Amazon Cognito</strong><br>
<a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html" target="_blank" rel="noopener noreferrer" class="">https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html</a></p>
</li>
<li class="">
<p><strong>Artículo externo: AWS Cognito Token Security – One step closer (Truesec)</strong><br>
<a href="https://www.truesec.com/hub/blog/aws-cognito-token-security-one-step-closer" target="_blank" rel="noopener noreferrer" class="">https://www.truesec.com/hub/blog/aws-cognito-token-security-one-step-closer</a></p>
</li>
<li class="">
<p><strong>Artículo externo: AWS Cognito Privilege Escalation Using Custom Attributes Editing in User Pool</strong><br>
<a href="https://medium.com/%40un1quely/aws-cognito-privilege-escalation-using-custom-attributes-editing-in-user-pool-2f8d6eaa3c7f" target="_blank" rel="noopener noreferrer" class="">https://medium.com/%40un1quely/aws-cognito-privilege-escalation-using-custom-attributes-editing-in-user-pool-2f8d6eaa3c7f</a></p>
</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentacion/proyectos/docrew/documentacion/incidencias-cibersec/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Incidencias de ciberseguridad</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentacion/proyectos/pops/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Resumen POPS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ksyA thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-resumen-ejecutivo" class="table-of-contents__link toc-highlight">1. Resumen ejecutivo</a></li><li><a href="#2-contexto-técnico-de-la-aplicación" class="table-of-contents__link toc-highlight">2. Contexto técnico de la aplicación</a><ul><li><a href="#21-arquitectura-de-autenticación" class="table-of-contents__link toc-highlight">2.1. Arquitectura de autenticación</a></li><li><a href="#22-uso-de-tokens-en-la-aplicación" class="table-of-contents__link toc-highlight">2.2. Uso de tokens en la aplicación</a></li></ul></li><li><a href="#3-análisis-del-alcance-awscognitosigninuseradmin" class="table-of-contents__link toc-highlight">3. Análisis del alcance <code>aws.cognito.signin.user.admin</code></a><ul><li><a href="#31-definición-del-scope" class="table-of-contents__link toc-highlight">3.1. Definición del scope</a></li><li><a href="#32-permisos-de-atributos-y-alcance-real" class="table-of-contents__link toc-highlight">3.2. Permisos de atributos y alcance real</a></li><li><a href="#33-relación-con-la-dependencia-aws-amplify" class="table-of-contents__link toc-highlight">3.3. Relación con la dependencia <code>aws-amplify</code></a></li></ul></li><li><a href="#4-evaluación-de-impacto-para-el-aplicativo" class="table-of-contents__link toc-highlight">4. Evaluación de impacto para el aplicativo</a><ul><li><a href="#41-riesgo-teórico-descrito-en-el-pentest" class="table-of-contents__link toc-highlight">4.1. Riesgo teórico (descrito en el pentest)</a></li><li><a href="#42-riesgo-real-dependiente-de-configuración" class="table-of-contents__link toc-highlight">4.2. Riesgo real (dependiente de configuración)</a></li></ul></li><li><a href="#5-plan-de-tratamiento-y-medidas-de-mitigación" class="table-of-contents__link toc-highlight">5. Plan de tratamiento y medidas de mitigación</a><ul><li><a href="#51-revisión-y-restricción-de-atributos-de-usuario" class="table-of-contents__link toc-highlight">5.1. Revisión y restricción de atributos de usuario</a></li><li><a href="#52-ajuste-de-tiempos-de-vida-de-tokens" class="table-of-contents__link toc-highlight">5.2. Ajuste de tiempos de vida de tokens</a></li><li><a href="#53-separación-de-capacidades-administrativas" class="table-of-contents__link toc-highlight">5.3. Separación de capacidades administrativas</a></li><li><a href="#54-monitoreo-y-auditoría" class="table-of-contents__link toc-highlight">5.4. Monitoreo y auditoría</a></li></ul></li><li><a href="#6-conclusión-y-clasificación-final-del-hallazgo" class="table-of-contents__link toc-highlight">6. Conclusión y clasificación final del hallazgo</a></li><li><a href="#7-referencias" class="table-of-contents__link toc-highlight">7. Referencias</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>